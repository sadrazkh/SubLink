using System.Text;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using SubLink.Data;

namespace SubLink.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class SubsController : ControllerBase
    {
        private readonly ApplicationDbContext _dbContext;

        public SubsController(ApplicationDbContext dbContext)
        {
            _dbContext = dbContext;
        }


        [HttpGet("{name}")]

        public async Task<string> Get(string name)
        {
            //Todo Log User

            //var user = await _dbContext.Users.FindAsync(userId);
            //var ips = await _dbContext.InternetServiceProviders.Where(c => c.Code == netOperator)
            //    .SelectMany(c => c.CleanIps)
            //    .Where(c => c.Active)
            //    .Select(s => s.IP)
            //    .OrderBy(c => Guid.NewGuid())
            //    .Take(10).ToListAsync();

            var netOperator = " IRC";

            var ips = ConfigGenerator.GetIpPerInternetOperator(name);

            var user = new { Name = "Sadra", Password = "0lKYuzWcph", Server = "Spain31" };
            var domain = "shopely.xyz";

            if (name == "mci")
            {
                user = new { Name = "Sadra", Password = "vl7FhIWbzV", Server = "Italy10" };
                domain = "sadilo.shop";
                netOperator = " MCI";
            }


            StringBuilder res = new StringBuilder();
            foreach (var ip in ips)
            {
                switch (user.Server)
                {
                    case "London":
                        res.Append(ConfigGenerator.GetLondonConfig(user.Password, $"{user.Name}-{netOperator}", "sadaltest", ip, domain));
                        break;
                    case "Sweden76":
                        res.Append(ConfigGenerator.GetSweden76Config(user.Password, $"{user.Name}-{netOperator}", "sadal", ip, domain));
                        break;
                    case "Spain31":
                        res.Append(ConfigGenerator.GetSpain31Config(user.Password, $"{user.Name}-{netOperator}", "sadal", ip, domain));
                        break;
                    case "USA89":
                        res.Append(ConfigGenerator.GetUSA89Config(user.Password, $"{user.Name}-{netOperator}", "sadal", ip, domain));
                        break;
                    case "France41":
                        res.Append(ConfigGenerator.GetFrance41Config(user.Password, $"{user.Name}-{netOperator}", "sadal", ip, domain));
                        break;
                    case "Italy10":
                        res.Append(ConfigGenerator.GetItaly10Config(user.Password, $"{user.Name}-{netOperator}", "sadaltest", ip, domain));
                        break;
                    default:
                        res.Append("\n");
                        break;
                }
            }

            //return res.ToString();

            var plainTextBytes = System.Text.Encoding.UTF8.GetBytes(res.ToString());
            return System.Convert.ToBase64String(plainTextBytes);
        }


    }

    public class Config
    {
        public string password { get; set; }
        public string Server { get; set; }
        public string Name { get; set; }
    }

    public static class ConfigGenerator
    {
        public static List<string> GetIpPerInternetOperator(string internetOperator)
        {
            switch (internetOperator)
            {
                case "mci":
                    return new List<string>()
                    {
                        "166.1.131.196","195.201.41.197","65.109.203.209","185.139.230.157","166.1.131.196",
                        "192.200.160.6", "192.200.160.4", "192.200.160.38", "23.227.60.130",
                        "31.43.179.33", "31.43.179.51", "45.85.118.21", "45.85.118.61", "45.85.118.205", "45.85.119.25",
                        "45.85.119.26", "45.85.119.87", "45.85.119.122", "45.85.119.141",
                        "45.85.119.188", "104.16.6.143", "104.16.6.244", "104.16.15.218", "104.16.16.153", "104.16.20.157", "104.16.21.121",
                        "104.16.23.64", "203.22.223.108", "89.116.250.10", "89.116.250.8", "89.116.250.49",
                        "45.159.216.87","203.23.103.31","203.23.106.134","104.31.16.6","104.31.16.4",
                        "104.31.16.11","104.31.16.7","104.31.16.28","104.31.16.27","104.31.16.3",
                        "104.31.16.26","104.31.16.14","104.31.16.13", "104.31.16.17", "104.31.16.16",
                        "104.31.16.29", "104.31.16.30", "104.31.16.12", "104.31.16.5", "104.31.16.25",
                        "104.31.16.20", "104.31.16.32", "104.31.16.31", "104.31.16.1", "104.31.16.18",
                        "104.31.16.22", "104.31.16.36", "104.31.16.43", "104.31.16.45", "104.31.16.42", "104.31.16.38",
                        "104.31.16.44", "104.31.16.37", "104.31.16.50", "104.31.16.40", "104.31.16.54", "104.31.16.51",
                        "104.31.16.59", "104.31.16.60", "104.31.16.61", "104.31.16.62", "104.31.16.58", "104.31.16.57",
                        "104.31.16.56", "104.31.16.67", "104.31.16.68", "104.31.16.65", "104.31.16.69", "104.31.16.71",
                        "104.31.16.73", "104.31.16.77", "104.31.16.78", "104.31.16.72", "104.31.16.74", "104.31.16.75",
                        "104.31.16.76", "104.31.16.80", "104.31.16.79", "104.31.16.84", "104.31.16.82", "104.31.16.83",
                        "104.31.16.85", "104.31.16.81", "104.31.16.86", "104.31.16.91", "104.31.16.87", "104.31.16.93",
                        "104.31.16.94", "104.31.16.92", "104.31.16.90", "104.31.16.95", "104.31.16.88", "104.31.16.89",
                        "104.31.16.96", "104.31.16.97", "104.31.16.98", "104.31.16.99", "104.31.16.100", "104.31.16.101",
                        "104.31.16.171", "104.31.16.172", "104.31.16.173", "104.31.16.180", "104.31.16.223", "104.31.16.239",
                        "104.31.16.242", "104.31.16.244", "104.31.16.243", "104.31.16.246", "104.31.16.252", "104.31.16.247",
                        "104.31.16.248", "104.31.16.249", "104.31.16.251", "104.31.16.250", "104.31.16.254", "162.159.24.18",
                        "162.159.26.226", "162.159.35.87", "162.159.35.227", "162.159.38.8", "162.159.38.100", "162.159.38.118",
                        "162.159.44.16", "162.159.45.39", "162.159.45.87", "45.85.119.41", "203.17.126.133", "45.131.4.199",
                        "45.131.5.214", "45.159.218.212", "45.159.219.20", "188.42.88.144", "192.65.217.231", "194.152.44.160",
                        "194.36.55.44", "195.245.221.97", "195.245.221.93", "203.13.32.10", "203.23.106.156", "23.227.60.144",
                    };
                case "irc":
                    return new List<string>()
                    {
                        "irc.irnetfree.info",
                        "irc1.irnetfree.info",
                        "irc2.irnetfree.info",
                        "irc3.irnetfree.info",
                    };
                case "irc1":
                    return new List<string>()
                    {
                        "95.179.241.60",
                        "95.179.243.130",
                        "95.179.243.184",
                        "95.179.244.214",
                        "95.179.245.139",
                        "95.179.246.202",
                        "95.179.250.81",
                        "95.179.255.134",
                        "95.179.255.199",
                        "199.247.19.174",
                        "45.76.83.197",
                        "45.76.85.173",
                        "45.76.92.26",
                        "45.76.92.71",
                        "95.179.168.124",
                        "95.179.169.223",
                        "45.63.119.169",
                        "199.247.0.16",
                        "199.247.0.116",
                        "199.247.0.160",
                        "199.247.0.186",
                        "199.247.0.226",
                        "199.247.0.236",
                        "199.247.2.131",
                        "199.247.2.255",
                        "199.247.4.212",
                        "199.247.5.61",
                        "199.247.9.190",
                        "199.247.17.2",
                        "199.247.20.252",
                        "199.247.21.147",
                        "199.247.22.54",
                        "199.247.22.44",
                        "199.247.23.172",
                        "199.247.28.164",
                        "136.244.81.173",
                        "136.244.86.248",
                        "136.244.87.9",
                        "136.244.88.16",
                        "95.179.202.57",
                        "95.179.240.154",
                        "95.179.241.150",
                        "95.179.244.134",
                        "95.179.248.77",
                        "95.179.250.43",
                        "95.179.250.86",
                        "95.179.251.153",
                        "95.179.254.20",
                        "45.76.91.228",
                        "45.63.119.55",
                        "45.63.119.118",
                        "199.247.5.9",
                        "199.247.5.70",
                        "95.179.243.13",
                        "95.179.247.71",
                        "95.179.247.168",
                        "95.179.250.152",
                        "95.179.252.143",
                        "95.179.254.184",
                        "45.76.85.135",
                        "45.76.86.53",
                        "45.76.86.197",
                        "45.76.89.166",
                        "95.179.168.130",
                        "95.179.169.117",
                        "45.63.116.105",
                        "45.63.117.136",
                        "45.63.119.209",
                        "199.247.6.98",
                        "199.247.22.126",
                        "136.244.87.193",
                        "95.179.190.154",
                        "95.179.135.195",
                        "95.179.255.3",
                        "45.63.116.249",
                        "45.63.119.147",
                        "95.179.242.87",
                        "95.179.242.247",
                        "95.179.242.241",
                        "95.179.246.191",
                        "95.179.248.215",
                        "95.179.253.40"
                    };
                case "irc2":
                    return new List<string>()
                    {
                        "95.179.244.42",
                        "95.179.244.134",
                        "95.179.244.231",
                        "95.179.245.139",
                        "95.179.249.171",
                        "95.179.250.249",
                        "199.247.19.88",
                        "45.76.83.81",
                        "45.76.85.225",
                        "45.76.89.54",
                        "45.76.89.134",
                        "95.179.168.196",
                        "95.179.169.22",
                        "45.63.116.158",
                        "199.247.0.123",
                        "199.247.0.116",
                        "199.247.5.158",
                        "199.247.11.145",
                        "199.247.17.167",
                        "199.247.19.88",
                        "199.247.20.44",
                        "199.247.21.114",
                        "199.247.21.147",
                        "199.247.22.62",
                        "199.247.22.126",
                        "199.247.23.38",
                        "136.244.84.224",
                        "136.244.86.50",
                        "136.244.87.27",
                        "136.244.87.116",
                        "136.244.87.178",
                        "136.244.89.149",
                        "95.179.186.177",
                    };
                case "irc3":
                    return new List<string>()
                    {
                        "166.1.131.196","195.201.41.197","65.109.203.209","185.139.230.157","166.1.131.196",
                        "45.14.174.94", "95.179.240.154", "95.179.241.160", "95.179.243.13",
                        "95.179.244.34", "95.179.244.134", "95.179.244.231",
                        "95.179.244.246", "95.179.245.139", "95.179.245.238",
                        "95.179.246.122", "95.179.247.71", "95.179.248.182",
                        "95.179.250.43", "95.179.252.178", "95.179.254.184",
                        "199.247.19.168", "45.76.85.94", "45.76.85.111",
                        "45.76.85.223", "45.76.86.53", "45.76.86.197",
                        "45.76.91.49", "45.76.92.26", "45.76.92.71",
                        "45.63.117.176", "45.63.117.187", "199.247.0.116",
                        "199.247.0.160", "199.247.4.37", "199.247.4.162",
                        "199.247.5.245", "199.247.6.41", "199.247.6.98",
                        "199.247.11.145", "199.247.19.168", "199.247.20.44",
                        "199.247.21.147", "199.247.21.169", "199.247.22.126",
                        "199.247.22.228", "199.247.23.75", "80.240.28.64",
                        "104.238.176.244", "104.207.130.42", "154.84.175.87",
                        "154.84.175.111", "154.84.175.147", "154.84.175.170",
                        "136.244.81.179", "136.244.81.173", "136.244.84.9",
                        "136.244.84.63", "136.244.86.248", "136.244.88.10",
                        "136.244.89.149", "192.248.179.53", "170.114.45.6",
                    };
                case "mkb":
                    return new List<string>()
                    {
                        "80.240.30.10",
                        "95.179.253.245",
                        "95.179.246.202",
                        "95.179.242.162"
                    };
                case "tbzmkb":
                    return new List<string>()
                    {
                        "45.131.5.42", "45.131.5.72", "45.131.5.89", "45.131.5.162", "45.131.5.179", "45.131.5.230",
                        "45.131.6.22", "45.131.6.23", "45.131.6.7", "45.131.6.8", "45.131.6.41", "45.131.6.42",
                        "45.131.6.109", "45.131.7.40", "45.131.7.74", "45.131.7.129", "45.131.7.125", "45.131.7.124",
                        "45.131.7.231", "45.131.7.245", "45.131.7.244", "45.131.208.34", "45.131.208.75",
                        "45.131.209.5", "45.131.209.20", "45.131.209.34", "45.131.209.4", "45.131.209.35",
                        "45.131.209.118", "45.131.209.238", "45.131.210.23", "45.131.210.6", "45.131.210.32",
                        "45.131.211.168", "45.131.211.187", "45.131.211.221", "45.133.247.36", "45.133.247.37",
                        "31.43.179.6", "31.43.179.5", "31.43.179.39", "31.43.179.40", "31.43.179.56", "31.43.179.142",
                        "45.8.104.17", "45.8.104.3", "45.8.104.16", "45.8.104.38", "45.8.104.120", "45.8.104.123",
                        "45.8.107.3", "45.8.107.18", "45.8.107.34", "45.8.107.19", "45.8.107.37", "45.8.107.52",
                        "45.8.107.71", "45.8.107.136", "45.8.107.170", "45.8.107.238", "45.8.211.35", "45.8.211.51",
                        "45.8.211.73", "45.8.211.141", "45.8.211.239", "45.8.211.252", "45.14.174.15", "45.14.174.165",
                        "45.80.111.10", "45.80.111.39", "45.80.111.105", "45.80.111.104", "45.85.118.4", "45.85.118.38",
                        "45.85.119.201", "45.85.119.218", "45.87.175.39", "45.87.175.1", "45.87.175.16", "45.87.175.49",
                        "45.87.175.122", "45.87.175.175", "45.87.175.205", "45.94.169.31", "45.94.169.15",
                        "45.94.169.14", "45.94.169.40", "45.94.169.74", "45.94.169.134", "45.142.120.14",
                        "45.142.120.15", "45.142.120.30", "45.142.120.29", "45.142.120.40", "45.142.120.100",
                        "45.142.120.183", "", "80.94.83.19", "80.94.83.39", "80.94.83.68", "80.94.83.49", "80.94.83.54",
                        "80.94.83.174", "80.94.83.205", "80.94.83.204", "80.94.83.226", "89.116.250.18",
                        "89.116.250.226", "89.116.250.241", "89.116.250.240", "91.195.110.4", "91.195.110.5",
                        "91.195.110.222", "94.140.0.32", "94.140.0.20", "94.140.0.23", "94.140.0.7", "94.140.0.54",
                        "94.140.0.108", "94.140.0.114", "94.140.0.159", "94.140.0.190", "94.140.0.216", "94.140.0.231",
                        "188.114.97.212", "188.114.97.207", "188.114.97.208", "188.114.98.3", "188.114.98.12",
                        "188.114.98.19", "188.114.98.18", "188.114.98.31", "188.114.98.46", "188.114.98.105",
                        "188.114.99.73", "188.114.99.181", "188.244.122.20", "188.244.122.21", "188.244.122.4",
                        "188.244.122.127", "188.244.122.157", "188.244.122.209", "188.244.122.244", "188.42.88.8",
                        "188.42.88.11", "188.42.88.26", "188.42.88.60", "188.42.88.110", "188.42.88.181",
                        "188.42.89.44", "188.42.89.146", "188.42.89.181", "188.42.89.250", "188.42.89.249",
                        "190.93.244.224", "190.93.245.28", "190.93.245.32", "190.93.245.1", "190.93.245.24",
                        "190.93.245.15", "190.93.245.14", "190.93.245.35", "190.93.245.45", "190.93.245.71",
                        "190.93.245.75", "190.93.245.88", "190.93.245.122", "185.201.139.122", "185.174.138.35",
                        "192.200.160.41", "141.101.115.14", "141.101.114.58", "141.101.123.17", "141.101.120.141",
                        "141.101.121.253", "141.101.115.78", "141.101.113.177", "141.101.121.189", "185.201.139.84",
                        "141.101.115.149", "185.176.24.215", "141.101.113.172", "141.101.113.144", "141.101.122.208",
                        "141.101.120.104", "141.101.114.246", "141.101.114.229", "192.200.160.76", "185.221.160.221",
                        "23.227.39.142", "141.101.115.40", "141.101.120.17", "185.221.160.236", "23.227.39.244",
                        "185.174.138.208", "141.101.114.11", "141.101.115.179", "192.200.160.7", "185.148.104.24",
                        "141.101.121.211", "185.148.104.11", "23.227.38.20", "141.101.120.1", "23.227.38.8",
                        "141.101.120.103", "66.235.200.133", "185.174.138.31", "141.101.115.36", "185.174.138.13",
                        "185.59.218.217", "185.174.138.28", "185.174.138.73", "141.101.114.27", "141.101.114.28",
                        "185.59.218.64", "23.227.39.6", "141.101.115.114", "185.148.105.9", "23.227.38.6",
                        "185.221.160.226", "141.101.120.121", "185.201.139.181", "185.59.218.35", "185.59.218.218",
                        "185.174.138.241", "64.68.192.16", "141.101.114.199", "141.101.120.35", "23.227.60.103",
                        "185.59.218.231", "185.174.138.12", "141.101.121.241", "23.227.39.33", "23.227.38.37",
                        "141.101.123.18", "141.101.120.18", "141.101.123.6", "185.201.139.128", "185.174.138.208",
                        "141.101.113.129", "185.174.138.34", "185.174.138.13", "185.148.104.25", "185.174.138.28",
                        "185.148.106.9", "141.101.115.213", "185.201.139.167", "66.235.200.70", "23.227.38.23",
                        "141.101.121.238", "185.174.138.34", "66.235.200.118", "141.101.120.52", "141.101.121.4",
                        "185.221.160.55", "185.174.138.35", "141.101.120.171", "185.59.218.52", "185.201.139.144",
                        "141.101.120.188", "23.227.60.73", "185.176.24.226", "23.227.60.44", "185.221.160.205",
                        "23.227.39.230", "141.101.120.193", "141.101.114.135", "141.101.113.132", "185.148.105.235",
                        "185.221.160.16", "185.201.139.69", "23.227.60.43", "185.148.106.27", "23.227.39.202",
                        "141.101.114.10", "141.101.123.32", "185.201.139.47", "64.68.192.236", "185.148.106.10",
                        "66.235.200.121", "185.148.105.25", "185.221.160.32", "141.101.113.128", "64.68.192.17",
                        "141.101.123.3", "141.101.123.21", "185.176.24.6", "185.148.105.99", "23.227.39.9",
                        "185.148.105.129", "23.227.39.24", "64.68.192.15", "23.227.60.253", "185.221.160.1",
                        "185.221.160.17", "185.176.24.24", "185.176.24.27", "23.227.60.254", "64.68.192.227",
                        "185.148.105.182"
                    };
                    break;
                case "ztl":
                    return GetIpPerInternetOperator("irc");
                    break;
                case "mbt":
                    return GetIpPerInternetOperator("irc");
                    break;

                default: return GetIpPerInternetOperator("mkb");
            }

        }


        public static string GetLondonConfig(string password, string name, string sni, string ip, string domain)
            =>
                $"trojan://{password}@{ip}:443?security=tls&sni=lndgb-{sni}.{domain}&type=ws&path=/protr&host=lond.{domain}#Server%20Trojan%20GB%20%F0%9F%87%AC%F0%9F%87%A7-{name}\n";

        public static string GetSweden76Config(string password, string name, string sni, string ip, string domain)
            =>
                $"trojan://{password}@{ip}:443?security=tls&sni=swd76-{sni}.{domain}&type=ws&path=/chat&host=sweden76.{domain}#Pro%2076%20%F0%9F%87%B8%F0%9F%87%AA-{name}\n";

        public static string GetSpain31Config(string password, string name, string sni, string ip, string domain)
            =>
                $"trojan://{password}@{ip}:443?security=tls&sni=sps31-{sni}.{domain}&type=ws&path=/chat&host=spain31.{domain}#Pro 31 🇪🇸-{name}\n";

        public static string GetFrance41Config(string password, string name, string sni, string ip, string domain)
            =>
                $"trojan://{password}@{ip}:443?security=tls&sni=fr41-{sni}.{domain}&type=ws&path=/chat&host=france41.{domain}#Trojan%20Server%2041%20%F0%9F%87%AB%F0%9F%87%B7-{name}\n";

        public static string GetUSA89Config(string password, string name, string sni, string ip, string domain)
            =>
                $"trojan://{password}@{ip}:443?security=tls&sni=hs89-{sni}.{domain}&type=ws&path=/chat&host=hillsboro.{domain}#Trojan%20Server%2089%20%F0%9F%87%BA%F0%9F%87%B8-{name}\n";

        public static string GetItaly10Config(string password, string name, string sni, string ip, string domain)
            =>
                $"trojan://{password}@{ip}:443?security=tls&sni=italy10-{sni}.{domain}&type=ws&path=/chat&host=italy10.{domain}#Pro%2010%20%F0%9F%87%AE%F0%9F%87%B9-{name}\n";
    }

}
